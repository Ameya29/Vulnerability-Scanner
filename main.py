import socket
import time
import pyfiglet
import sys

def main():
    mybanner = pyfiglet.figlet_format("Port  Scanner")
    print(mybanner)
    print('Variations: \n1. Scan Number Of Ports \n2. Scan A Specific Port')
    choice = int(input('Enter Your Choice: '))
    # print(choice)
    if choice == 1:
        portscan()
    elif choice == 2:
        spec_portscan()
    else:
        print('Invalid Choice')

def portscan():
    # print('Port Scan Loading...')
    target = input('Enter Target Domain/IP To Scan: ')
    numports = int(input('Enter Number Of Ports To Scan: '))
    print("\nScanning "+target+"..\nPlease Be Patient \n(This May Take Few Minutes)\n")
    start = time.time()
    try:
        for port in range(1, numports):
            sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
            socket.setdefaulttimeout(0.5)
            result = sock.connect_ex((target, port))
            if result == 0:
                print(f"Port {port} Is Open!")
            sock.close()
    except KeyboardInterrupt:
        print("\nExiting Program!!")
        sys.exit()
    except socket.gaierror:
        print("Hostname Couldn't Be Resolved!!")
        sys.exit()
    except socket.error:
        print("Server Not Responding!!")
        sys.exit()
    end = time.time()
    print(f"\nScanned {numports} Ports In {end-start:.2f} Seconds.")

def spec_portscan():
    # print('Specific Port Scan Loading...')
    target = input('Enter Target Domain/IP To Scan: ')
    portnum = int(input('Enter Port Number To Scan: '))
    start = time.time()
    try:
        sock= socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        socket.setdefaulttimeout(0.25)
        result = sock.connect_ex((target, portnum))
        if result == 0:
            print(f"\nPort {portnum} Is Open!")
        else:
            print(f"\nPort {portnum} Is Closed!")
    except socket.gaierror:
        print("Hostname Couldn't Be Resolved!")
        sys.exit()
    except socket.error:
        print("Server Not Responding!")
        sys.exit()
    end = time.time()
    print(f"Scanning Done In {end-start:.2f} Seconds")

if __name__ == '__main__':
    main()